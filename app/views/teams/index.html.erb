<% provide(:title, @tournament.name) %>

<%# トーナメント共通ヘッダ %>
<% if @tournament.elimination? %>
  <%= render "shared/elimination_header", { elimination: @tournament.elimination, current_page: "チーム" } %>
<% elsif @tournament.roundrobin? %>
  <%= render "shared/roundrobin_header", { roundrobin: @tournament.roundrobin, current_page: "チーム" } %>
<% end %>

<div class="container-lg my-3">
  <p>
    最大16チーム登録できます。<br>
    大会開始後は、追加、削除、シャッフル、一括更新ができません。
  </p>

  <div class="d-flex flex-row-reverse justify-content-between align-items-end mb-3">
    <p class="lead m-0"><%= @teams.size %>チーム</p>

    <div>
      <% if @tournament.teams.size < MAX_TEAMS && @tournament.games.empty? %>
        <%= link_to new_tournament_team_path(@tournament),
                    class: "btn btn-outline-main",
                    data: { turbo_frame: dom_id(Team.new) } do %>
          <i class="bi bi-person-plus"></i> 追加
        <% end %>
      <% end %>

      <% if @tournament.teams.present? && @tournament.games.empty? %>
        <%= link_to shuffle_tournament_teams_path(@tournament),
                    class: "btn btn-outline-main",
                    data: { "turbo-method": :post, turbo_confirm: "参加チームの配置をシャッフルします。", turbo_frame: "_top" } do %>
          <i class="bi bi-shuffle"></i> シャッフル
        <% end %>
      <% end %>

    </div>
  </div>

  <div class="mb-3">
    <%= turbo_frame_tag Team.new %>
  </div>

  <% if @teams.present? %>
    <%= turbo_frame_tag "teams" do %>
      <div class="d-grid gap-0 nameplate-cover mb-3">
        <%= render @teams %>
      </div>
    <% end %>

  <% else %>
    <div class="alert alert-warning mb-3">参加チームは未登録です</div>
  <% end %>

  <%# 一括アップデート %>
  <% if @tournament.games.empty? %>
    <div class="mt-5">
      <%= form_with(url: bulk_update_tournament_teams_path(@tournament), data: { turbo_frame: "_top" }) do |form| %>
        <%= turbo_frame_tag "bulk_update_error" %>
        <%= turbo_frame_tag "teams_names_tag" do %>
          <%= render "teams_names", { teams_names: @teams_names } %>
        <% end %>

        <div class="d-flex mt-2 gap-1 justify-content-end">
          <%= form.submit('一括更新', class: "btn btn-outline-main") %>
        </div>
      <% end %>
    </div>
  <% end %>

</div>




